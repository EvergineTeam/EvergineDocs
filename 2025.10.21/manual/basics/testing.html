<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Testing | Evergine Doc </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Testing | Evergine Doc ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  <meta property="docfx:rel" content="../../">
  
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container flex-container">
            <label for="version" class="select-label">Version:</label>
            <select id="select-version" class="select-version" name="version" title="version">
            </select>
            <div class="hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="testing">Testing</h1>

<p><img src="images/testsHeader.png" alt=""></p>
<p>In all of its forms, testing has became a good practice in the software industry. From speeding debugging scenarios up, to avoiding regressions, for having two examples, it has demostrated how efficient the technique is once we developers embrace it.</p>
<p>Testing applications made with Evergine can be difficult from the instant some of its pieces are involved: components, behaviors, drawables, services and so on. In the end, Evergine is highly coupled to a graphics backend, thus a GPU, and such are not usually available in every machine, nor help to automate the testing scenario.</p>
<h2 id="approach">Approach</h2>
<p>We officially provide Evergine.Mocks, distributed in its own NuGet package, which enables testing applications made with Evergine (inspired on <a href="https://github.com/jonathanpeppers/Xamarin.Forms.Mocks">Xamarin.Forms.Mocks</a>). Its single goal is to enable testing logic, leaving out of scope drawables or anything related to rendering.</p>
<p>Most of our applications contain a bunch of components (it-self, or behaviors/drawables) which contain logic. Such components, usually, consume other artifacts from outside:</p>
<ul>
<li>other components</li>
<li>services</li>
<li>managers</li>
<li>entities from its hierarchy</li>
</ul>
<p>Beacause of this, isolating a component for testing is quite complicated. However, we can rely on a mock Windows System which, in a headless fashion, replicates the same behavior the app would have.</p>
<p>Evergine.Mocks is independant on the testing framework, although we always rely on <a href="https://xunit.net">xUnit</a>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Leave Application.Initialize() empty: refactor its entire logic into a separate public method, called from each WindowsSystem
<ul>
<li>This is needed to avoid tests setting the ScreenContext up and navigating to an actual Scene by default</li>
</ul>
</li>
</ul>
<pre><code class="lang-csharp">windowsSystem.Run(
    () =&gt;
    {
        // Pull initialization logic from here...
        application.Initialize();
        // to here
        application.NavigateToMainScene();
    },
    () =&gt;
    {
        [...]
    });
</code></pre>
<ul>
<li>Execute tests sequentially: Evergine currently does not support running tests in parallel
<ul>
<li><p>For example, you can configure it with xUnit by adding a new file AssemblyInfo.cs (if it is not already present) with the following line in it:</p>
<pre><code class="lang-csharp">[assembly: Xunit.CollectionBehavior(DisableTestParallelization = true)]
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="create-your-first-test">Create your first test</h2>
<ol start="0">
<li>Make sure you have already followed above requirements</li>
<li>Create a project to hold the tests (we use to name it equal to the Evergine project, plus &quot;.Tests&quot; at the end) targetting the same .NET version as the Evergine's one (the one referenced by every launcher). Choose one option:
<ul>
<li>Visual Studio already has the template xUnit Test Project ready to use</li>
<li>Create a new Class Library project and add xUnit</li>
</ul>
</li>
<li>Add a project reference to the Evergine's one</li>
<li>Add Evergine.Mocks package reference (double check it shares the same version as the rest of Evergine dependencies)</li>
<li>Back to the Evergine project, create the following component:</li>
</ol>
<pre><code class="lang-csharp">public class MyComponent : Component
{
    public bool MyBooleanProperty { get; private set; }

    protected override void Start()
    {
        base.Start();
        this.MyBooleanProperty = true;
    }
}
</code></pre>
<ol start="5">
<li>Back to the tests project, add the following class:</li>
</ol>
<pre><code class="lang-csharp">public class MyComponentShould
{
    private readonly MyComponent component;

    private readonly MockWindowsSystem windowsSystem;

    public MyComponentShould()
    {
        this.component = new MyComponent();
        var entity = new Entity()
            .AddComponent(this.component);
        var scene = new MockScene();
        scene.Add(entity);
        var application = new MyApplication();
        this.windowsSystem = MockWindowsSystem.Create(application, scene);
    }

    [Fact]
    public void KeepMyBooleanPropertyFalseBeforeStarting()
    {
        // Arrange

        // Act

        // Assert
        Assert.False(this.component.MyBooleanProperty);
    }

    [Fact]
    public void ChangeMyBooleanPropertyToTrueOnStart()
    {
        // Arrange

        // Act
        this.windowsSystem.RunOneLoop(TimeSpan.FromSeconds(1d / 60));

        // Assert
        Assert.True(this.component.MyBooleanProperty);
    }
}
</code></pre>
<ol start="6">
<li>Run tests at the Test Explorer panel (View, Test Explorer) by clicking on the play button:</li>
</ol>
<p><img src="images/testExplorer.png" alt=""></p>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">

              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <h5>In this article</h5>
              <div></div>
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div class="pull-left">
        
        <span>Generated by <strong>DocFX</strong></span>
            </div>      
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
